FireSpark={core:{service:{},workflow:{},helper:{},constant:{}},ui:{service:{},workflow:{},helper:{},constant:{},template:{}},smart:{service:{},workflow:{},helper:{},constant:{}}};FireSpark.core.helper.CheckEmail=function(){var a=/^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/;return function(b,c){if(!a.test($(this).val())){FireSpark.core.service.CheckForm.result=false;FireSpark.core.helper.checkFail($(this),FireSpark.core.constant.validation_status+" .error");return false}}}();FireSpark.core.helper.checkFail=function(a,b){return a.next(b).stop(true,true).slideDown(1e3).delay(5e3).fadeOut(1e3)};FireSpark.core.service.CheckForm={result:true,input:function(){return{required:["form"],optional:{error:"span",validations:FireSpark.core.constant.validations}}},run:function(a){FireSpark.core.service.CheckForm.result=true;FireSpark.core.constant.validation_status=a["error"];$validations=a["validations"];for(var b in $validation){$check=$validation[b];$(a["form"]+" "+$check["cls"]).each($check["helper"]);if(!FireSpark.core.service.CheckForm.result)break}a["valid"]=FireSpark.core.service.CheckForm.result;return a},output:function(){return[]}};FireSpark.core.helper.CheckMatch=function(){var a=false;return function(b,c){if(b&&a&&$(this).val()!=a){FireSpark.core.service.CheckForm.result=false;FireSpark.core.helper.checkFail($(this),FireSpark.core.constant.validation_status+" .error");return false}a=$(this).val()}}();FireSpark.core.helper.CheckRequired=function(){return function(a,b){if($(this).val()==""){FireSpark.core.service.CheckForm.result=false;FireSpark.core.helper.checkFail($(this),FireSpark.core.constant.validation_status+" .error");return false}}}();FireSpark.core.service.DataCookie={input:function(){return{required:["key"],optional:{expires:1,value:null,path:"/"}}},run:function(a){$.cookie(a["key"],null,{path:a["path"]});$.cookie(a["key"],a["value"],{expires:a["expires"],path:a["path"]});a["valid"]=true;return a},output:function(){return[]}};FireSpark.core.service.DataEncode={input:function(){return{optional:{type:"url",data:false,url:""}}},run:function(a){var b=a["data"];var c=a["type"];var d="application/x-www-form-urlencoded";if(b!==false&&b!=""){b=b.replace(/\+/g,"%20");if(c!="url"){var e=b.split("&");var f={};for(var g=0,h=e.length;g<h;g++){var i=e[g].split("=");f[i[0]]=unescape(i[1])}a["data"]=b=f}switch(c){case"json":b=JSON.stringify(b);d="application/json";break;case"rest-id":a["url"]=a["url"]+"/"+b["id"];case"url":default:break}}a["result"]=b;a["mime"]=d;a["valid"]=true;return a},output:function(){return["data","result","mime","url"]}};FireSpark.core.helper.dataEquals=function(a,b){return a==b};FireSpark.core.service.DataRegistry={input:function(){return{required:["key"],optional:{value:false}}},run:function(a){if(a["value"]===false){a["value"]=Snowblozm.Registry.get(a["key"])}else{Snowblozm.Registry.save(a["key"],a["value"])}a["valid"]=true;return a},output:function(){return["value"]}};FireSpark.core.helper.dataShort=function(a,b,c){var d=b||15;var e=d-5;return c?a.length<d?a:a.substr(0,e)+" ...":a};FireSpark.core.helper.dataSplit=function(a,b){b=b||":";return a.split(b)};FireSpark.jquery.service.LaunchHash={idle:true,current:"",input:function(){return{}},run:function(a){if(FireSpark.jquery.service.LaunchHash.idle&&FireSpark.jquery.service.LaunchHash.current!=window.location.hash){FireSpark.jquery.service.LaunchHash.current=window.location.hash;Snowblozm.Kernel.launch(FireSpark.jquery.service.LaunchHash.current)}a["valid"]=true;return a},output:function(){return[]}};FireSpark.core.service.LaunchMessage={input:function(){return{optional:{data:{},launch:false,status:"valid",message:"message"}}},run:function(a){if(a["launch"]){var b=a["data"]||{};if(b[a["status"]]||false){var c=a["message"];var d=b[c]||false;if(d){d["service"]=Snowblozm.Registry.load(a["launch"]);return Snowblozm.Kernel.run(d,{})}}}a["valid"]=true;return a},output:function(){return[]}};FireSpark.core.service.LaunchNavigator={input:function(){return{optional:{data:[],launch:false,escaped:false}}},run:function(a){if(a["launch"]){$data=a["data"];for(var b in $data){Snowblozm.Kernel.launch($data[b],a["escaped"])}}a["valid"]=true;return a},output:function(){return[]}};FireSpark.core.service.LaunchTrigger={input:function(){return{required:["selector","attribute"],optional:{event:"click",escaped:false,hash:false,pathname:false}}},run:function(a){$(a["selector"]).live(a["event"],function(){FireSpark.jquery.service.LaunchHash.idle=false;var b=$root.attr(a["attribute"]);if(a["attribute"]=="href"){b=unescape(b)}$result=Snowblozm.Kernel.launch(b,a["escaped"],$(this));if(a["hash"]){FireSpark.jquery.service.LaunchHash.current=window.location.hash=b}FireSpark.jquery.service.LaunchHash.idle=true;return $result});a["valid"]=true;return a},output:function(){return[]}};FireSpark.jquery.service.LoadAjax={input:function(){return{required:["url","workflow"],optional:{data:"",type:"json",request:"POST",process:false,mime:"application/x-www-form-urlencoded",errorflow:false,stop:false}}},run:function(a){FireSpark.jquery.helper.LoadBarrier.start();$.ajax({url:a["url"],data:a["data"],dataType:a["type"],type:a["request"],processData:a["process"],contentType:a["mime"],success:function(b,c,d){a["data"]=b;Snowblozm.Kernel.execute(a["workflow"],a);FireSpark.jquery.helper.LoadBarrier.end()},error:function(b,c,d){a["error"]=d;a["data"]=FireSpark.core.constant.loaderror+'<span class="hidden"> [Error : '+d+"]</span>";if(a["errorflow"]){Snowblozm.Kernel.execute(a["errorflow"],a)}FireSpark.jquery.helper.LoadBarrier.end()}});return{valid:a["stop"]}},output:function(){return[]}};FireSpark.jquery.helper.LoadBarrier={requests:0,barrier_function:false,start:function(){this.requests++},end:function(){this.requests--;if(this.requests<=0){this.requests=0;if(this.barrier_function){this.barrier_function()}this.barrier_function=false}},barrier:function(a){this.barrier_function=a}};FireSpark.core.service.LoadBarrier={input:function(){return{optional:{barrier:false}}},run:function(a){if(a["barrier"]){FireSpark.jquery.helper.LoadBarrier.barrier(function(){Snowblozm.Kernel.execute(a["barrier"],a)})}a["barrier"]=false;a["valid"]=true;return a},output:function(){return["barrier"]}};FireSpark.jquery.service.LoadIframe={input:function(){return{required:["agent","workflow"],optional:{type:"json",errorflow:false}}},run:function(a){FireSpark.jquery.helper.LoadBarrier.start();var b=new Date;var c="firespark_iframe_"+b.getTime();$(a["agent"]).attr("target",c);var d=$('<iframe id="'+c+'" name="'+c+'" style="width:0;height:0;border:0px solid #fff;"></iframe>').insertAfter(a["agent"]).bind("load",function(){try{var b=FireSpark.core.helper.getFrame(c);var d=b.document.body.innerHTML;switch(a["type"]){case"html":a["data"]=d;break;case"json":default:a["data"]=$.parseJSON(d);break}Snowblozm.Kernel.execute(a["workflow"],a);FireSpark.jquery.helper.LoadBarrier.end()}catch(e){a["error"]=e.description;a["result"]=FireSpark.core.constant.loaderror+'<span class="hidden"> [Error :'+e.description+"]</span>";if(a["errorflow"]){Snowblozm.Kernel.execute(a["errorflow"],a)}FireSpark.jquery.helper.LoadBarrier.end()}}).bind("error",function(b){a["error"]=b;a["result"]=FireSpark.core.constant.loaderror;if(a["errorflow"]){Snowblozm.Kernel.execute(a["errorflow"],a)}FireSpark.jquery.helper.LoadBarrier.end()});window.setTimeout(function(){d.remove()},15e4);return{valid:true}},output:function(){return[]}};FireSpark.core.service.ReadData={input:function(){return{required:["cntr"],optional:{cls:"data"}}},run:function(a){var b=new Date;var c="_ts="+b.getTime();var d=function(a,b){if($(this).attr("name")||false){c=c+"&"+$(this).attr("name")+"="+$(this).val()}};$(a["cntr"]+" ."+a["cls"]).each(d);a["data"]=c;a["valid"]=true;return a},output:function(){return["data"]}};FireSpark.core.helper.readDate=function(a){var b=new Date(a);return b.toDateString()};FireSpark.core.helper.readFileSize=function(a){var b=a/1024;if(b>1024){var c=b/1024;return c.toFixed(2)+" MB"}return b.toFixed(2)+" KB"};FireSpark.core.service.ReadForm={input:function(){return{required:["form"]}},run:function(a){var b=$(a["form"]);a["url"]=b.attr("action");a["request"]=b.attr("method").toUpperCase();var c=b.serialize();var d=new Date;c=c+"&_ts="+d.getTime();a["data"]=c;a["valid"]=true;return a},output:function(){return["url","request","data"]}};FireSpark.core.helper.readGender=function(a){switch(a){case"M":return"Male";case"F":return"Female";case"N":default:return"";break}};FireSpark.core.service.WindowConfirm={input:function(){return{required:["value"],optional:{confirm:false}}},run:function(a){if(a["confirm"]){a["valid"]=confirm(a["value"]);return a}a["valid"]=true;return a},output:function(){return[]}};FireSpark.core.helper.windowFrame=function(a){for(var b=0;b<frames.length;b++){if(frames[b].name==a)return frames[b]}return false};FireSpark.core.service.WindowReload={input:function(){return{optional:{"continue":false}}},run:function(a){window.location.hash="";if(a["continue"]){window.location=a["continue"]}else{window.location.reload()}a["valid"]=false;return a},output:function(){return[]}};FireSpark.ui.service.ContainerData={input:function(){return{optional:{key:"ui-global",id:"0",iframe:false,root:false,agent:false,url:"",data:"",type:"json",request:"POST",process:false,mime:"application/x-www-form-urlencoded",workflowend:{service:FireSpark.ui.service.ContainerRender},errorflowend:{service:FireSpark.ui.service.ElementContent},loaddata:FireSpark.core.constant.loadmsg,anm:"fadein",dur:1e3,dly:0,stop:false}}},run:function(a){if(a["iframe"]){var b=FireSpark.core.service.LoadIframe}else{var b=FireSpark.core.service.LoadAjax}var c=a["key"]+"-"+a["id"];var d=Snowblozm.Registry.get(c)||false;if(d||false){return Snowblozm.Kernel.run(a["workflowend"],a)}else{return Snowblozm.Kernel.execute([{service:FireSpark.ui.service.ElementContent,element:"#load-status",select:true,animation:"slidein",data:'<span class="state loading">Loading ...</span>',duration:500},{service:b,args:a["args"],agent:a["agent"]||a["root"],workflow:[a["workflowend"]],errorflow:[a["errorflowend"]]}],a)}a["valid"]=true;return a},output:function(){return[]}};FireSpark.jquery.service.ContainerRemove={input:function(){return{optional:{key:"ui-global",id:"0",ins:"#ui-global-0",inl:false}}},run:function(a){var b=a["key"]+"-"+a["id"];if(a["inl"]||false){}else{a=Snowblozm.Kernel.execute([{service:FireSpark.jquery.service.ElementContent,element:".tls-"+b,select:true,action:"remove"},{service:FireSpark.jquery.service.ElementContent,element:".tlc-"+b,select:true,action:"remove"},{service:FireSpark.jquery.workflow.TileShow}],a)}a["valid"]=false;return a},output:function(){return[]}};FireSpark.ui.service.ContainerRender={input:function(){return{optional:{key:"ui-global",id:"0",ins:"ui-global-0",root:false,tpl:"#tpl-def-tls",inl:false,act:"first",tile:false,data:{},anm:"fadein",dur:1e3,dly:0,bg:false}}},run:function(a){var b=a["key"]+"-"+a["id"];var c=Snowblozm.Registry.get(b)||false;if(c||false){}else{c=a["data"]}c["id"]=a["id"];c["key"]=a["key"];c["instance"]=a["ins"];if(c["valid"]||false){}else{Snowblozm.Registry.save(b,false);return Snowblozm.Kernel.run({service:FireSpark.ui.service.ElementContent,element:"#load-status",select:true,animation:"slidein",data:'<span class="error">'+c["msg"]+'</span><span class="hidden">'+c["details"]+"</span>",duration:500},{})}var d=function(){c["ui"]=c["ui"]||c["message"]["ui"]||false;if(c["ui"]||false){$templates=c["ui"]["templates"]||{};$flag=false;for(var d in $templates){if(Snowblozm.Registry.get($templates[d])||false){}else{$flag=true;break}}if($flag||false){$("#load-status").html('<span class="error">Error Loading Data</span>').stop(true,true).hide().slideDown(500).delay(1500).slideUp(1500);return}}$("#load-status").html('<span class="state">Initializing ...</span>').stop(true,true).hide().slideDown(500).delay(500).slideUp(1500);if(a["inl"]||false){}else{a=Snowblozm.Kernel.execute([{service:FireSpark.ui.service.ElementContent,element:".tls-"+b,select:true,action:"remove"},{service:FireSpark.ui.workflow.TemplateApply,input:{action:"act",animation:"anm",duration:"dur",delay:"dly"},element:a["ins"]+">.tiles",select:true,animation:"fadein",template:a["tpl"]+"-tls",data:c}],a);if(a["valid"]||false){}else{return a}}$workflow=[{service:FireSpark.ui.service.ElementContent,element:".tlc-"+b,select:true,action:"remove"},{service:FireSpark.ui.workflow.TemplateApply,input:{action:"act",animation:"anm",duration:"dur",delay:"dly"},element:a["ins"]+">.bands",select:true,template:a["tpl"]+"-tcs",animation:"none",data:c}];if(a["bg"]||false){}else{$workflow.push({service:FireSpark.ui.workflow.TileShow})}a=Snowblozm.Kernel.execute($workflow,a);Snowblozm.Registry.save(b,c)};c["ui"]=c["message"]["ui"];if(c["ui"]||false){$templates=c["ui"]["templates"]||{};a["tpl"]=c["ui"]["tpl"];FireSpark.core.ajax.barrier(d);$barrier=false;$("#load-status").html('<span class="state loading">Loading ...</span>').stop(true,true).slideDown(500);for(var e in $templates){if(Snowblozm.Registry.get($templates[e])||false){}else{$barrier=true;Snowblozm.Kernel.execute([{service:FireSpark.core.service.DataRegistry,key:$templates[e],value:true},{service:FireSpark.core.service.LoadAjax,url:$templates[e],type:"html",request:"GET",workflow:[{service:FireSpark.ui.service.ElementContent,element:"#ui-templates",select:true,action:"last",duration:5}],errorflow:[{service:FireSpark.core.service.DataRegistry,key:$templates[e]}]}],{})}}if(!$barrier)d()}else{d()}a["valid"]=true;return a},output:function(){return["element"]}};FireSpark.ui.service.ElementContent={input:function(){return{required:["element"],optional:{select:false,data:"",animation:"fadein",duration:1e3,delay:0,action:"all"}}},run:function(a){if(a["select"]){var b=$(a["element"]);if(!b.length&&a["action"]!="remove"){b=$("#main-container")}}else{b=a["element"]}var c=a["animation"];var d=a["duration"];if(c=="fadein"||c=="slidein"){b.hide()}switch(a["action"]){case"all":b.html(a["data"]);b.trigger("load");break;case"first":b.prepend(a["data"]);b.trigger("load");break;case"last":b.append(a["data"]);b.trigger("load");break;case"remove":b.remove();break;default:break}if(a["action"]!="remove"){b.stop(true,true).delay(a["delay"]);switch(c){case"fadein":b.fadeIn(d);break;case"fadeout":b.fadeOut(d);break;case"slidein":b.slideDown(d);break;case"slideout":b.slideUp(d);break;case"none":break;default:b.html("Animation type not supported").fadeIn(d);break}}a["element"]=b;a["valid"]=true;return a},output:function(){return["element"]}};FireSpark.ui.service.ElementSection={input:function(){return{required:["element"],optional:{select:false,content:false,child:".tile-content",animation:"fadein",duration:500,delay:0}}},run:function(a){if(a["select"]){var b=$(a["element"]);if(!b.length){b=$("#main-container")}}else{b=a["element"]}b.children(a["child"]).hide();if(a["content"]){b=b.children(a["content"])}else{b=b.children(a["child"]).eq(0)}var c=a["animation"];var d=a["duration"];b.trigger("load");b.delay(a["delay"]);switch(c){case"fadein":b.fadeIn(d);break;case"slidein":b.slideDown(d);break;default:b.html("Animation type not supported").fadeIn(d);break}a["element"]=b;a["valid"]=true;return a},output:function(){return["element"]}};FireSpark.ui.service.ElementState={input:function(){return{optional:{element:false,disabled:false}}},run:function(a){if(a["element"]){if(a["disabled"]){$(a["element"]).attr("disabled",true)}else{$(a["element"]).removeAttr("disabled")}}a["valid"]=true;return a},output:function(){return[]}};FireSpark.ui.service.ElementTab={input:function(){return{required:["tabui","title"],optional:{autoload:false,taburl:false}}},run:function(a){var b=Snowblozm.Registry.get(a["tabui"]);a["element"]=b.add(a["title"],a["autoload"],a["taburl"]);a["valid"]=true;return a},output:function(){return["element"]}};FireSpark.ui.service.TemplateApply={input:function(){return{required:["template"],optional:{data:{}}}},run:function(a){a["result"]=$.tmpl(a["template"],a["data"]);a["valid"]=true;return a},output:function(){return["result"]}};FireSpark.ui.service.TemplateRead={input:function(){return{optional:{template:"tpl-default"}}},run:function(a){$tpl=a["template"];$template=Snowblozm.Registry.get($tpl);if(!$template&&$tpl.charAt(0)=="#"){$template=$.template($tpl);if($template){Snowblozm.Registry.save($tpl,$template)}}a["result"]=$template;a["valid"]=$template||false?true:false;return a},output:function(){return["result"]}};FireSpark.ui.helper.transformButton=function(a,b){a.button();return a};FireSpark.ui.helper.transformCKEditor=function(a,b){var c=a;a.each(function(a,b){var d=c.attr("id")||c.attr("name");var e=CKEDITOR.instances[d]||false;if(e){try{CKEDITOR.remove(e)}catch(f){}delete e}c=c.slice(1)});a.ckeditor();return a};FireSpark.ui.helper.transformTabpanel=function(a,b){a.hide();var c=new Array;var d=b["indexstart"];var e={cache:b["cache"],collapsible:b["collapsible"],event:b["event"],tabTemplate:"<li><a href='#{href}'>#{label}</a> <span class='ui-icon ui-icon-close'>Remove Tab</span></li>",add:function(a,b){c[d]=$(b.panel)}};if(b["tablink"]){e.load=function(a,b){$("a",b.panel).click(function(){$(b.panel).load(this.href);return false})}}var f=a.tabs(e);a.fadeIn(1e3);$(".ui-icon-close").live("click",function(){var a=$("li",f).index($(this).parent());f.tabs("remove",a)});d--;Snowblozm.Registry.save(b["savekey"],{add:function(a,b,e){d++;var g="#ui-tab-"+d;if(b||false){g=e}f.tabs("add",g,a);f.tabs("select","#ui-tab-"+d);return c[d]}});return a};FireSpark.ui.service.TransformTrigger={input:function(){return{optional:{transform:FireSpark.ui.constant.transforms}}},run:function(a){$transforms=a["transforms"];for(var b in $transforms){$tx=$tranform[b];$($tx["cls"]).live("load",function(){$helper=$tx["helper"];$helper($(this),$tx["config"])})}a["valid"]=true;return a},output:function(){return[]}};FireSpark.core.constant={validations:{required:{cls:".required",helper:FireSpark.core.helper.CheckRequired},email:{cls:".email",helper:FireSpark.core.helper.CheckEmail},match:{cls:".match",helper:FireSpark.core.helper.CheckMatch}},validation_status:"span"};FireSpark.ui.constant={transforms:{uibutton:{cls:".uibutton",helper:FireSpark.ui.helper.transformButton,config:{}},ckeditor:{cls:".ckeditor",helper:FireSpark.ui.helper.transformCKEditor,config:{}},uitabpanel:{cls:".uitabpanel",helper:FireSpark.ui.helper.transformTabpanel,config:{savekey:"tabpanel",select:false,cache:false,collapsible:false,event:"click",tablink:false,indexstart:0}}}}